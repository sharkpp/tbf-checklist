(window["webpackJsonptbf-checklist"]=window["webpackJsonptbf-checklist"]||[]).push([[0],{44:function(e,t,r){e.exports=r(73)},49:function(e,t,r){},50:function(e,t,r){e.exports=r.p+"static/media/logo.5d5d9eef.svg"},51:function(e,t,r){},73:function(e,t,r){"use strict";r.r(t);var o=r(0),c=r.n(o),n=r(39),a=r.n(n);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(33),r(49);var i=r(21),l=r(22),s=r(27),u="https://cors-anywhere.herokuapp.com/https://techbookfest.org/api",d=/^(.+?)([0-9]+)(.*)$/;function h(e){var t=[].concat(d.exec(e)||["",0,""]).slice(1),r=t[0].codePointAt(0);return 1e3*(12353<=r&&r<=12435?r-12353+10:["\u904b","\u5354"].indexOf(t[0]))+ +t[1]}var m=function(){function e(){Object(i.a)(this,e),this._event=new s,this._store={orderBy:{booth:[]},lookupBy:{booth:{}},circles:{}},this._waitCircleList=null}return Object(l.a)(e,[{key:"request",value:function(e){var t=this;(e=e||{}).circleId=e.circleId||null;var r=[],o=!1;e.circleId?r.push("".concat(u,"/circle/").concat(e.circleId)):(this._waitCircleList=o=!0,r.push("".concat(u,"/circle?eventID=").concat("tbf07","&eventExhibitCourseID=3&visibility=site&limit=100&onlyAdoption=true")));!function e(){var c=r.shift();c?fetch(c,{method:"GET"}).then((function(e){return e.json()})).then((function(o){if(o.cursor&&r.unshift("".concat(c.replace(/&cursor=.+$/,""),"&cursor=").concat(o.cursor)),console.log("CircleModel request",o),o.list)for(var n,a=0;n=o.list[a];++a){t._store.circles[n.id]=n;for(var i,l=0;i=n.spaces[l];++l)t._store.lookupBy.booth[i]=n.id,t._store.orderBy.booth.indexOf(i)<0&&t._store.orderBy.booth.push(i)}else{var s=o;t._store.circles[s.id]=s;for(var u,d=0;u=s.spaces[d];++d)t._store.lookupBy.booth[u]=s.id,t._store.orderBy.booth.indexOf(u)<0&&t._store.orderBy.booth.push(u)}return t._store.orderBy.booth=t._store.orderBy.booth.sort((function(e,t){return h(e)-h(t)})),t._event.emit("change"),e()})).catch((function(e){return console.error(e)})):(o&&(console.log("CircleModel request comp!"),t._waitCircleList=!1),t._event.emit("change"),t._event.emit("loaded"))}()}},{key:"on",value:function(e,t){this._event.on(e,t),0<=["change","loaded"].indexOf(e)&&!1===this._waitCircleList&&t(e)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"getCircleListOrderByBooth",value:function(){var e=this;return(this._store.orderBy.booth||[]).map((function(t){return(e.getCircleByBooth(t)||{}).id}))}},{key:"getCircleByBooth",value:function(e){return this._store.circles[this._store.lookupBy.booth[e]]}},{key:"getCircleBoothOrder",value:function(e){return!1!==this._waitCircleList?-2:this._store.orderBy.booth.indexOf(((this._store.circles[e]||{}).spaces||[])[0])}},{key:"getCircle",value:function(e){return!1===this._waitCircleList&&this._store.circles[e]}},{key:"getFirstBooth",value:function(){return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[0])}},{key:"getLastBooth",value:function(){return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[this._store.orderBy.booth.length-1])}},{key:"getPrevSiblingsBooth",value:function(e){var t=((this._store.circles[e]||{}).spaces||[])[0],r=this._store.orderBy.booth.indexOf(t);return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[r-1])}},{key:"getNextSiblingsBooth",value:function(e){var t=((this._store.circles[e]||{}).spaces||[])[0],r=this._store.orderBy.booth.indexOf(t);return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[r+1])}}]),e}(),f=r(27),v=function(){function e(){Object(i.a)(this,e),this._event=new f,this._store={orderBy:{seq:{}},products:{}}}return Object(l.a)(e,[{key:"request",value:function(e){var t=this;(e=e||{}).circleId=e.circleId||null;var r=[];if(e.circleId){r.push("".concat("https://cors-anywhere.herokuapp.com/https://techbookfest.org/api","/product?circleExhibitInfoID=").concat(e.circleId,"&limit=100"));!function e(){var o=r.shift();o?fetch(o,{method:"GET"}).then((function(e){return e.json()})).then((function(c){if(c.cursor&&r.unshift("".concat(o.replace(/&cursor=.+$/,""),"&cursor=").concat(c.cursor)),console.log("ProductModel request",c),c.list)for(var n,a=0;n=c.list[a];++a){var i=n.circleExhibitInfoID;t._store.products[i]=t._store.products[i]||{},t._store.products[i][n.id]=n,t._store.orderBy.seq[i]=t._store.orderBy.seq[i]||[],t._store.orderBy.seq[i][n.seq-1]=n.id}return t._event.emit("change"),e()})).catch((function(e){return console.error(e)})):(t._event.emit("change"),t._event.emit("loaded"))}()}}},{key:"on",value:function(e,t){this._event.on(e,t)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"getProductOrder",value:function(e,t){var r=this._store.orderBy.seq[e]||[];return r?r.indexOf(t):-1}},{key:"getProductList",value:function(e){var t=this._store.products[e];return t&&Object.keys(t)}},{key:"getProductByIndex",value:function(e,t){return(this._store.products[e]||{})[(this._store.orderBy.seq[e]||[])[t]]||!1}},{key:"getProduct",value:function(e,t){return(this._store.products[e]||{})[t]||!1}},{key:"getProductCount",value:function(e){var t=this._store.orderBy.seq[e];return t?t.length:-1}},{key:"getPrevSiblings",value:function(e,t){var r=this._store.products[e],o=this._store.orderBy.seq[e],c=o&&o.indexOf(t);return o&&r[o[c-1]]||!1}},{key:"getNextSiblings",value:function(e,t){var r=this._store.products[e],o=this._store.orderBy.seq[e],c=o&&o.indexOf(t);return console.log("getNextSiblings",o,r),o&&r[o[c+1]]||!1}}]),e}(),p=r(27),g=function(){function e(){Object(i.a)(this,e),this._event=new p,this._store={}}return Object(l.a)(e,[{key:"on",value:function(e,t){this._event.on(e,t)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"isFavorite",value:function(e,t){return!!(t?this._store[e]&&this._store[e][t]:this._store[e]&&this._store[e].circle)}},{key:"setFavorite",value:function(e,t){if(console.log("setFavorite",e,t),e){this._store[e]=this._store[e]||{circle:null};var r=t||"circle",o=!0!==this._store[e][r];this._store[e][r]=!0,o&&this._event.emit("change",{circleId:e,productId:t,favorite:!0})}}},{key:"unsetFavorite",value:function(e,t){if(console.log("unsetFavorite",e,t),e){this._store[e]=this._store[e]||{circle:null};var r=t||"circle",o=!1!==this._store[e][r];this._store[e][r]=!1,o&&this._event.emit("change",{circleId:e,productId:t,favorite:!1})}}}]),e}(),y=r(24),_=r(16),E=(r(50),r(51),r(75)),b=r(40);var B=function(){return c.a.createElement("div",null,c.a.createElement(b.LinkContainer,{to:"/7/circle/"},c.a.createElement(E.a,null,"\u6280\u8853\u66f8\u5178\uff17")))},k=r(19),w=r(17),I=r(18),C=r(13),x=(r(60),r(10)),O=r.n(x),L=r(25),S=r.n(L),P=r(3),j=r.n(P),N=r(43);var q=function(e){var t=e.models,r=e.circleId,n=e.productId,a=t.favorite,i=Object(o.useState)(a.isFavorite(r,n)),l=Object(k.a)(i,2),s=l[0],u=l[1],d=Object(o.useCallback)((function(){return a.setFavorite(r,n)}),[]),h=Object(o.useCallback)((function(){return a.unsetFavorite(r,n)}),[]);return Object(o.useEffect)((function(){var e=function(e){r==e.circleId&&n==e.productId&&u(e.favorite)};return a.on("change",e),function(){a.off("change",e)}}),[a,r,n]),c.a.createElement("div",{style:{position:"absolute",top:0,right:0,padding:".75rem"},onClick:s?h:d},c.a.createElement(w.a,{icon:s?I.e:N.a,color:"#ffcc00",size:"lg",onClick:s?h:d}))};var F=function(e){var t=e.models,r=e.circleInfo,o=r&&r.circleCutImage||{url:"",width:0,height:1};return c.a.createElement("div",{className:"circle-card"},c.a.createElement(O.a,null,c.a.createElement(O.a.Header,null,c.a.createElement(S.a,{variant:"secondary"},(r.spaces||[])[0]),r.name||" ",c.a.createElement(q,{models:t,circleId:r&&r.id})),c.a.createElement("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"}},o.url&&c.a.createElement(O.a.Img,{variant:"top",src:o.url,style:{width:200*o.width/o.height,height:200}}),!o.url&&c.a.createElement("div",{style:{display:"inline-block",width:141,height:200,border:"5px solid black",overflow:"hidden"}},c.a.createElement("div",{style:{top:"50%",position:"relative",marginTop:"-0.5em"}},"NO IMAGE"))),c.a.createElement(O.a.Body,null,c.a.createElement(O.a.Text,null,c.a.createElement(j.a,null,c.a.createElement(j.a.Group,{controlId:"name"},c.a.createElement(j.a.Label,null,"\u30b5\u30fc\u30af\u30eb\u540d"),c.a.createElement("div",{className:"form-control-plaintext"},r.nameRuby?"".concat(r.name,"(").concat(r.nameRuby,")"):r.name)),c.a.createElement(j.a.Group,{controlId:"spaces"},c.a.createElement(j.a.Label,null,"\u914d\u7f6e"),c.a.createElement("div",{className:"form-control-plaintext"},r.spaces&&r.spaces[0]||"")),c.a.createElement(j.a.Group,{controlId:"penName"},c.a.createElement(j.a.Label,null,"\u30da\u30f3\u30cd\u30fc\u30e0"),c.a.createElement("div",{className:"form-control-plaintext"},r.penName)),c.a.createElement(j.a.Group,{controlId:"webSiteURL"},c.a.createElement(j.a.Label,null,"Web\u30b5\u30a4\u30c8"),c.a.createElement("div",{className:"form-control-plaintext"},r.webSiteURL)),c.a.createElement(j.a.Group,{controlId:"genre"},c.a.createElement(j.a.Label,null,"\u30b8\u30e3\u30f3\u30eb"),c.a.createElement("div",{className:"form-control-plaintext"},r.genre)),c.a.createElement(j.a.Group,{controlId:"genreFreeFormat"},c.a.createElement(j.a.Label,null,"\u30b8\u30e3\u30f3\u30eb\u8a73\u7d30"),c.a.createElement("div",{className:"form-control-plaintext"},r.genreFreeFormat)))))))},G={fanzine:"\u540c\u4eba\u8a8c",commerce:"\u5546\u696d\u8a8c"};var T=function(e){var t=e.models,r=e.circleInfo,o=e.productInfo,n=o&&o.images&&o.images[0]||{url:"",width:0,height:1};return c.a.createElement("div",{className:"product-card"},c.a.createElement(O.a,null,c.a.createElement(O.a.Header,null,c.a.createElement(S.a,{variant:"secondary"},(r.spaces||[])[0]),r.name||" ",c.a.createElement(q,{models:t,circleId:r&&r.id,productId:o&&o.id})),!1,c.a.createElement("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"}},n.url&&c.a.createElement(O.a.Img,{variant:"top",src:n.url,style:{width:200*n.width/n.height,height:200}})),c.a.createElement(O.a.Body,null,c.a.createElement(O.a.Text,null,c.a.createElement(j.a,null,c.a.createElement(j.a.Group,{controlId:"name"},c.a.createElement(j.a.Label,null,"\u9812\u5e03\u7269"),c.a.createElement("div",{className:"form-control-plaintext"},o.name)),c.a.createElement(j.a.Group,{controlId:"page"},c.a.createElement(j.a.Label,null,"\u7a2e\u985e / \u30da\u30fc\u30b8 / \u4fa1\u683c"),c.a.createElement("div",{className:"form-control-plaintext"},"".concat(G[o.type]," / ").concat(o.page," \u30da\u30fc\u30b8 / ").concat(o.price?o.price+" \u5186":""))),c.a.createElement(j.a.Group,{controlId:"firstAppearanceEventName"},c.a.createElement(j.a.Label,null,"\u521d\u51fa"),c.a.createElement("div",{className:"form-control-plaintext"},o.firstAppearanceEventName)),c.a.createElement(j.a.Group,{controlId:"description"},c.a.createElement(j.a.Label,null,"\u6982\u8981"),c.a.createElement("pre",{className:"form-control-plaintext"},o.description)))))))};var A=function(e){var t=e.models,r=e.history,n=e.params,a=t.circle,i=t.product,l=n.event,s=n.circleId,u=n.productId;console.log("CircleSelectView",{models:t,history:r,params:n});var d=Object(o.useState)(),h=Object(k.a)(d,2),m=h[0],f=h[1],v=Object(o.useState)(),p=Object(k.a)(v,2),g=p[0],y=p[1],_=Object(o.useState)(),E=Object(k.a)(_,2),b=E[0],B=E[1],x=Object(o.useState)(),O=Object(k.a)(x,2),L=O[0],S=O[1];Object(o.useEffect)((function(){var e=a.getCircle(s);e?y(e):a.request({circleId:s}),i.getProductList(s)?B(b):i.request({circleId:s})}),[a,s]),Object(o.useEffect)((function(){if(s){var e=i.getProduct(s,u);e?S(e):i.request({circleId:s})}}),[s,i,u]),Object(o.useEffect)((function(){var e=function(){if(console.log("CircleSelectView","onCircleChange",s,a.getCircle(s)),s)f(a.getCircleListOrderByBooth()),y(a.getCircle(s)),B(i.getProductList(s)),S(i.getProduct(s,u));else{var e=a.getFirstBooth();e&&r.replace("/".concat(l,"/circle/").concat(e.id))}},t=function(){console.log("CircleSelectView","onCircleLoaded",s,a.getCircle(s)),f(a.getCircleListOrderByBooth()),y(a.getCircle(s)),B(i.getProductList(s)),S(i.getProduct(s,u))},o=function(){console.log("CircleSelectView","onProductChange",s,u,i.getProduct(s,u)),B(i.getProductList(s)),S(i.getProduct(s,u))},c=function(){console.log("CircleSelectView","onProductLoaded",s,u,i.getProduct(s,u)),B(i.getProductList(s)),S(i.getProduct(s,u))};return a.on("change",e),a.on("loaded",t),i.on("change",o),i.on("loaded",c),function(){a.off("change",e),a.off("loaded",t),i.off("change",o),i.off("loaded",c)}}),[l,a,i,s,u,r]);var P=m||[],j=a.getCircleBoothOrder(s),N=[null].concat(b||[]),q=i.getProductOrder(s,u)+1;return c.a.createElement(C.c,{className:"circle-list",naturalSlideWidth:window.innerWidth,naturalSlideHeight:window.innerHeight,totalSlides:P.length,currentSlide:j},c.a.createElement(C.e,null,P.map((function(e,o){var n=g&&g.id==e?g:{id:e};return c.a.createElement(C.d,{key:"_".concat(e,"_").concat(o),index:o},c.a.createElement(C.c,{orientation:"vertical",key:"_".concat(e,"_carousel_").concat(o),className:"product-list",naturalSlideWidth:window.innerWidth,naturalSlideHeight:window.innerHeight,totalSlides:N.length,currentSlide:q},c.a.createElement(C.e,null,N.map((function(r,o){var a=L&&L.id==r?L:{id:r};return c.a.createElement(C.d,{key:"_".concat(e,"_").concat(u,"_").concat(o),index:o},a.name?c.a.createElement(T,{key:"_".concat(e,"_").concat(u,"_item_").concat(o),models:t,circleInfo:n,productInfo:a}):c.a.createElement(F,{key:"_".concat(e,"_").concat(u,"_item_").concat(o),models:t,circleInfo:n}))}))),c.a.createElement(C.a,{style:q-1<0?{display:"none"}:{},onClick:function(){console.log("ButtonTop");var e=i.getPrevSiblings(s,u);r.push(e?"/".concat(l,"/circle/").concat(s,"/").concat(e.id):"/".concat(l,"/circle/").concat(s))}},c.a.createElement(w.a,{icon:I.d,color:"black",size:"3x"})),c.a.createElement(C.b,{style:N.length<=q+1?{display:"none"}:{},onClick:function(){console.log("ButtonButton");var e=i.getNextSiblings(s,u);r.push(e?"/".concat(l,"/circle/").concat(s,"/").concat(e.id):"/".concat(l,"/circle/").concat(s))}},c.a.createElement(w.a,{icon:I.a,color:"black",size:"3x"}))))}))),c.a.createElement(C.a,{style:j-1<0?{display:"none"}:{},onClick:function(){console.log("ButtonBack");var e=a.getPrevSiblingsBooth(s);r.push("/".concat(l,"/circle/").concat(e.id))}},c.a.createElement(w.a,{icon:I.b,color:"black",size:"3x"})),c.a.createElement(C.b,{style:P.length<=j+1?{display:"none"}:{},onClick:function(){console.log("ButtonNext");var e=a.getNextSiblingsBooth(s);r.push("/".concat(l,"/circle/").concat(e.id))}},c.a.createElement(w.a,{icon:I.c,color:"black",size:"3x"})))};var W=function(e){var t=e.models;return c.a.createElement(y.BrowserRouter,null,!1,c.a.createElement(_.d,{path:"/",exact:!0,render:function(e){return c.a.createElement(B,{models:t,history:e.history,params:e.match.params})}}),c.a.createElement(_.d,{path:"/:event/circle/:circleId?/:productId?",render:function(e){return c.a.createElement(A,{models:t,history:e.history,params:e.match.params})}}))},z={circle:new m,product:new v,favorite:new g};z.circle.request(),a.a.render(c.a.createElement(W,{models:z}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[44,1,2]]]);
//# sourceMappingURL=main.435fdab0.chunk.js.map