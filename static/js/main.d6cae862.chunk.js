(window["webpackJsonptbf-checklist"]=window["webpackJsonptbf-checklist"]||[]).push([[0],{44:function(e,t,r){e.exports=r(71)},49:function(e,t,r){},50:function(e,t,r){},71:function(e,t,r){"use strict";r.r(t);var n=r(0),c=r.n(n),o=r(38),a=r.n(o);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(32),r(49);var i=r(20),s=r(21),l=r(26),u="https://cors-anywhere.herokuapp.com/https://techbookfest.org/api",d=/^(.+?)([0-9]+)(.*)$/,h="circle-cache";function f(e){var t=[].concat(d.exec(e)||["",0,""]).slice(1),r=t[0].codePointAt(0);return 1e3*(12353<=r&&r<=12435?r-12353+10:["\u904b","\u5354"].indexOf(t[0]))+ +t[1]}var m=function(){function e(){Object(i.a)(this,e),this._event=new l,this._store=Object.assign({loadCompleted:!1,orderBy:{booth:[]},lookupBy:{booth:{}},circles:{}},JSON.parse(sessionStorage.getItem(h))||{}),this._waitCircleList=null}return Object(s.a)(e,[{key:"_updateCache",value:function(){var e=JSON.stringify(this._store);console.debug("circle data len",e.length),sessionStorage.setItem(h,e)}},{key:"request",value:function(e){var t=this;(e=e||{}).circleId=e.circleId||null;var r=[],n=!1;e.circleId?r.push("".concat(u,"/circle/").concat(e.circleId)):(this._waitCircleList=n=!0,this._store.loadCompleted=!1,this._updateCache(),r.push("".concat(u,"/circle?eventID=").concat("tbf07","&eventExhibitCourseID=3&visibility=site&limit=100&onlyAdoption=true")));!function e(){var c=r.shift();c?fetch(c,{method:"GET"}).then((function(e){return e.json()})).then((function(n){if(n.cursor&&r.unshift("".concat(c.replace(/&cursor=.+$/,""),"&cursor=").concat(n.cursor)),n.list)for(var o,a=0;void 0!==(o=n.list[a]);++a){delete o.event,delete o.eventExhibitCourse,t._store.circles[o.id]=o;for(var i,s=0;void 0!==(i=o.spaces[s]);++s)t._store.lookupBy.booth[i]=o.id,t._store.orderBy.booth.indexOf(i)<0&&t._store.orderBy.booth.push(i)}else{var l=n;delete l.event,delete l.eventExhibitCourse,t._store.circles[l.id]=l;for(var u,d=0;void 0!==(u=l.spaces[d]);++d)t._store.lookupBy.booth[u]=l.id,t._store.orderBy.booth.indexOf(u)<0&&t._store.orderBy.booth.push(u)}return t._store.orderBy.booth=t._store.orderBy.booth.sort((function(e,t){return f(e)-f(t)})),t._updateCache(),t._event.emit("change"),e()})).catch((function(e){return console.error(e)})):(n&&(t._waitCircleList=!1,t._store.loadCompleted=!0),t._updateCache(),t._event.emit("change"),t._event.emit("loaded"))}()}},{key:"on",value:function(e,t){this._event.on(e,t),0<=["change","loaded"].indexOf(e)&&!1===this._waitCircleList&&t(e)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"getCircleListOrderByBooth",value:function(){var e=this;return(this._store.orderBy.booth||[]).map((function(t){return(e.getCircleByBooth(t)||{}).id}))}},{key:"getCircleByBooth",value:function(e){return this._store.circles[this._store.lookupBy.booth[e]]}},{key:"getCircleBoothOrder",value:function(e){return!1!==this._waitCircleList?-2:this._store.orderBy.booth.indexOf(((this._store.circles[e]||{}).spaces||[])[0])}},{key:"getCircle",value:function(e){return this._store.circles[e]}},{key:"getFirstBooth",value:function(){return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[0])}},{key:"getLastBooth",value:function(){return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[this._store.orderBy.booth.length-1])}},{key:"hasPrevSiblingsBooth",value:function(e){var t=this._store.circles[e];return!(!t||!t.prevCircleExhibitInfoID)}},{key:"hasNextSiblingsBooth",value:function(e){var t=this._store.circles[e];return!(!t||!t.nextCircleExhibitInfoID)}},{key:"getPrevSiblingsBooth",value:function(e){var t=this._store.circles[e];return t&&t.prevCircleExhibitInfoID&&this._store.circles[t.prevCircleExhibitInfoID]}},{key:"getNextSiblingsBooth",value:function(e){var t=this._store.circles[e];return t&&t.nextCircleExhibitInfoID&&this._store.circles[t.nextCircleExhibitInfoID]}}]),e}(),v=r(26),p=function(){function e(){Object(i.a)(this,e),this._event=new v,this._store={orderBy:{seq:{}},products:{}}}return Object(s.a)(e,[{key:"request",value:function(e){var t=this;(e=e||{}).circleId=e.circleId||null;var r=[];if(e.circleId){r.push("".concat("https://cors-anywhere.herokuapp.com/https://techbookfest.org/api","/product?circleExhibitInfoID=").concat(e.circleId,"&limit=100"));!function e(){var n=r.shift();n?fetch(n,{method:"GET"}).then((function(e){return e.json()})).then((function(c){if(c.cursor&&r.unshift("".concat(n.replace(/&cursor=.+$/,""),"&cursor=").concat(c.cursor)),c.list)for(var o,a=0;void 0!==(o=c.list[a]);++a){var i=o.circleExhibitInfoID;t._store.products[i]=t._store.products[i]||{},t._store.products[i][o.id]=o,t._store.orderBy.seq[i]=t._store.orderBy.seq[i]||[],t._store.orderBy.seq[i][o.seq-1]=o.id}return t._event.emit("change"),e()})).catch((function(e){return console.error(e)})):(t._event.emit("change"),t._event.emit("loaded"))}()}}},{key:"on",value:function(e,t){this._event.on(e,t)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"getProductOrder",value:function(e,t){var r=this._store.orderBy.seq[e]||[];return r?r.indexOf(t):-1}},{key:"getProductList",value:function(e){var t=this._store.products[e];return t&&Object.keys(t)}},{key:"getProductByIndex",value:function(e,t){return(this._store.products[e]||{})[(this._store.orderBy.seq[e]||[])[t]]||!1}},{key:"getProduct",value:function(e,t){return(this._store.products[e]||{})[t]||!1}},{key:"getProductCount",value:function(e){var t=this._store.orderBy.seq[e];return t?t.length:-1}},{key:"hasNextProduct",value:function(e,t){this._store.products[e];var r=this._store.orderBy.seq[e],n=r&&r.indexOf(t);return!(!r||!r[n+1])}},{key:"getPrevSiblings",value:function(e,t){var r=this._store.products[e],n=this._store.orderBy.seq[e],c=n&&n.indexOf(t);return n&&r[n[c-1]]||!1}},{key:"getNextSiblings",value:function(e,t){var r=this._store.products[e],n=this._store.orderBy.seq[e],c=n&&n.indexOf(t);return n&&r[n[c+1]]||!1}}]),e}(),b=r(26),g="favorite",_=function(){function e(){Object(i.a)(this,e),this._event=new b,this._store=JSON.parse(localStorage.getItem(g)||"{}")}return Object(s.a)(e,[{key:"on",value:function(e,t){this._event.on(e,t)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"isFavorite",value:function(e,t){return!!(t?this._store.tbf07&&this._store.tbf07[e]&&this._store.tbf07[e][t]:this._store.tbf07&&this._store.tbf07[e]&&this._store.tbf07[e].circle)}},{key:"setFavorite",value:function(e,t){if(e){this._store.tbf07=this._store.tbf07||{},this._store.tbf07[e]=this._store.tbf07[e]||{circle:null};var r=t||"circle",n=!0!==this._store.tbf07[e][r];this._store.tbf07[e][r]=!0,n&&(localStorage.setItem(g,JSON.stringify(this._store)),this._event.emit("change",{circleId:e,productId:t,favorite:!0}))}}},{key:"unsetFavorite",value:function(e,t){if(e){this._store.tbf07=this._store.tbf07||{},this._store.tbf07[e]=this._store.tbf07[e]||{circle:null};var r=t||"circle",n=!0===this._store.tbf07[e][r];delete this._store.tbf07[e][r],n&&(localStorage.setItem(g,JSON.stringify(this._store)),this._event.emit("change",{circleId:e,productId:t,favorite:!1}))}}}]),e}(),y=r(23),E=r(15),I=(r(50),r(72)),k=r(39);var x=function(){return c.a.createElement("div",null,c.a.createElement(k.LinkContainer,{to:"/7/circle/"},c.a.createElement(I.a,null,"\u6280\u8853\u66f8\u5178\uff17")))},B=r(18),C=r(16),O=r(17),w=r(13),N=r.n(w),L=r(24),S=r.n(L),j=r(3),P=r.n(j),q=r(42);var G=function(e){var t=e.models,r=e.circleId,o=e.productId,a=e.isCurrent,i=t.favorite,s=Object(n.useState)(i.isFavorite(r,o)),l=Object(B.a)(s,2),u=l[0],d=l[1],h=Object(n.useCallback)((function(){return i.setFavorite(r,o)}),[i,r,o]),f=Object(n.useCallback)((function(){return i.unsetFavorite(r,o)}),[i,r,o]);return Object(n.useEffect)((function(){var e=function(e){r===e.circleId&&o===e.productId&&d(e.favorite)};return a&&i.on("change",e),a?function(){i.off("change",e)}:function(){}}),[a,i,r,o]),c.a.createElement("div",{style:{position:"absolute",top:0,right:0,padding:".75rem"},onClick:u?f:h},c.a.createElement(C.a,{icon:u?O.e:q.a,color:"#ffcc00",size:"lg",onClick:u?f:h}))};var F=function(e){var t=e.models,r=e.circleInfo,n=e.isCurrent,o=r&&r.circleCutImage||{url:"",width:0,height:1};return c.a.createElement("div",{className:"circle-card"},c.a.createElement(N.a,null,c.a.createElement(N.a.Header,null,c.a.createElement(S.a,{variant:"secondary"},(r.spaces||[])[0]),r.name||" ",c.a.createElement(G,{models:t,isCurrent:n,circleId:r&&r.id})),c.a.createElement("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"}},o.url&&c.a.createElement(N.a.Img,{variant:"top",src:o.url,style:{width:200*o.width/o.height,height:200}}),!o.url&&c.a.createElement("div",{style:{display:"inline-block",width:141,height:200,border:"5px solid black",overflow:"hidden"}},c.a.createElement("div",{style:{top:"50%",position:"relative",marginTop:"-0.5em"}},"NO IMAGE"))),c.a.createElement(N.a.Body,null,c.a.createElement("div",{className:"card-text"},c.a.createElement(P.a,null,c.a.createElement(P.a.Group,{controlId:"name"},c.a.createElement(P.a.Label,null,"\u30b5\u30fc\u30af\u30eb\u540d"),c.a.createElement("div",{className:"form-control-plaintext"},r.nameRuby?"".concat(r.name,"(").concat(r.nameRuby,")"):r.name)),c.a.createElement(P.a.Group,{controlId:"spaces"},c.a.createElement(P.a.Label,null,"\u914d\u7f6e"),c.a.createElement("div",{className:"form-control-plaintext"},r.spaces&&r.spaces[0]||"")),c.a.createElement(P.a.Group,{controlId:"penName"},c.a.createElement(P.a.Label,null,"\u30da\u30f3\u30cd\u30fc\u30e0"),c.a.createElement("div",{className:"form-control-plaintext"},r.penName)),c.a.createElement(P.a.Group,{controlId:"webSiteURL"},c.a.createElement(P.a.Label,null,"Web\u30b5\u30a4\u30c8"),c.a.createElement("div",{className:"form-control-plaintext"},r.webSiteURL)),c.a.createElement(P.a.Group,{controlId:"genre"},c.a.createElement(P.a.Label,null,"\u30b8\u30e3\u30f3\u30eb"),c.a.createElement("div",{className:"form-control-plaintext"},r.genre)),c.a.createElement(P.a.Group,{controlId:"genreFreeFormat"},c.a.createElement(P.a.Label,null,"\u30b8\u30e3\u30f3\u30eb\u8a73\u7d30"),c.a.createElement("div",{className:"form-control-plaintext"},r.genreFreeFormat)))))))},D={fanzine:"\u540c\u4eba\u8a8c",commerce:"\u5546\u696d\u8a8c"};var A=function(e){var t=e.models,r=e.circleInfo,n=e.productInfo,o=e.isCurrent,a=n&&n.images&&n.images[0]||{url:"",width:0,height:1};return c.a.createElement("div",{className:"product-card"},c.a.createElement(N.a,null,c.a.createElement(N.a.Header,null,c.a.createElement(S.a,{variant:"secondary"},(r.spaces||[])[0]),r.name||" ",c.a.createElement(G,{models:t,isCurrent:o,circleId:r&&r.id,productId:n&&n.id})),!1,c.a.createElement("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"}},a.url&&c.a.createElement(N.a.Img,{variant:"top",src:a.url,style:{width:200*a.width/a.height,height:200}})),c.a.createElement(N.a.Body,null,c.a.createElement("div",{className:"card-text"},c.a.createElement(P.a,null,c.a.createElement(P.a.Group,{controlId:"name"},c.a.createElement(P.a.Label,null,"\u9812\u5e03\u7269"),c.a.createElement("div",{className:"form-control-plaintext"},n.name)),c.a.createElement(P.a.Group,{controlId:"page"},c.a.createElement(P.a.Label,null,"\u7a2e\u985e / \u30da\u30fc\u30b8 / \u4fa1\u683c"),c.a.createElement("div",{className:"form-control-plaintext"},"".concat(D[n.type]," / ").concat(n.page," \u30da\u30fc\u30b8 / ").concat(n.price?n.price+" \u5186":""))),c.a.createElement(P.a.Group,{controlId:"firstAppearanceEventName"},c.a.createElement(P.a.Label,null,"\u521d\u51fa"),c.a.createElement("div",{className:"form-control-plaintext"},n.firstAppearanceEventName)),c.a.createElement(P.a.Group,{controlId:"description"},c.a.createElement(P.a.Label,null,"\u6982\u8981"),c.a.createElement("pre",{className:"form-control-plaintext"},n.description)))))))};Object.assign({display:"none"},{background:"transparent",border:"0px solid transparent"});var J=function(e){var t=e.models,r=e.history,o=e.params,a=t.circle,i=t.product,s=o.event,l=o.circleId,u=o.productId,d=Object(n.useState)(),h=Object(B.a)(d,2),f=(h[0],h[1]),m=Object(n.useState)(),v=Object(B.a)(m,2),p=v[0],b=v[1],g=Object(n.useState)(),_=Object(B.a)(g,2),y=_[0],E=_[1],k=Object(n.useState)(),x=Object(B.a)(k,2),w=x[0],N=x[1];Object(n.useEffect)((function(){var e=a.getCircle(l);e?b(e):a.request({circleId:l}),i.getProductList(l)?E(y):i.request({circleId:l})}),[a,l,i,y]),Object(n.useEffect)((function(){if(l){var e=i.getProduct(l,u);e?N(e):i.request({circleId:l})}}),[l,i,u]),Object(n.useEffect)((function(){var e=function(){if(l)f(a.getCircleListOrderByBooth()),b(a.getCircle(l)),E(i.getProductList(l)),N(i.getProduct(l,u));else{var e=a.getFirstBooth();e&&r.replace("/".concat(s,"/circle/").concat(e.id))}},t=function(){f(a.getCircleListOrderByBooth()),b(a.getCircle(l)),E(i.getProductList(l)),N(i.getProduct(l,u))},n=function(){E(i.getProductList(l)),N(i.getProduct(l,u))},c=function(){E(i.getProductList(l)),N(i.getProduct(l,u))};return a.on("change",e),a.on("loaded",t),i.on("change",n),i.on("loaded",c),function(){a.off("change",e),a.off("loaded",t),i.off("change",n),i.off("loaded",c)}}),[s,a,i,l,u,r]),a.getCircleBoothOrder(l),[null].concat(y||[]),i.getProductOrder(l,u);var L=p||{id:l},S=w||{id:u};return c.a.createElement("div",{className:"card-container"},w&&w.name?c.a.createElement(A,{key:"_".concat(l,"_").concat(u),isCurrent:!0,models:t,circleInfo:L,productInfo:S}):c.a.createElement(F,{key:"_".concat(l),isCurrent:!0,models:t,circleInfo:L}),c.a.createElement(I.a,{variant:"link",className:"circle-prev"+(a.hasPrevSiblingsBooth(l)?"":" btn-hidden"),onClick:function(){var e=a.getPrevSiblingsBooth(l);r.push("/".concat(s,"/circle/").concat(e.id))}},c.a.createElement(C.a,{icon:O.b,color:"black",size:"3x"})),c.a.createElement(I.a,{variant:"link",className:"circle-next"+(a.hasNextSiblingsBooth(l)?"":" btn-hidden"),onClick:function(){var e=a.getNextSiblingsBooth(l);r.push("/".concat(s,"/circle/").concat(e.id))}},c.a.createElement(C.a,{icon:O.c,color:"black",size:"3x"})),c.a.createElement(I.a,{variant:"link",className:"product-prev"+(u?"":" btn-hidden"),onClick:function(){var e=i.getPrevSiblings(l,u);r.push(e?"/".concat(s,"/circle/").concat(l,"/").concat(e.id):"/".concat(s,"/circle/").concat(l))}},c.a.createElement(C.a,{icon:O.d,color:"black",size:"3x"})),c.a.createElement(I.a,{variant:"link",className:"product-next"+(i.hasNextProduct(l,u)?"":" btn-hidden"),onClick:function(){var e=i.getNextSiblings(l,u);r.push(e?"/".concat(s,"/circle/").concat(l,"/").concat(e.id):"/".concat(s,"/circle/").concat(l))}},c.a.createElement(C.a,{icon:O.a,color:"black",size:"3x"})))};var z=function(e){var t=e.models;return c.a.createElement(y.HashRouter,null,!1,c.a.createElement(E.d,{path:"/",exact:!0,render:function(e){return c.a.createElement(x,{models:t,history:e.history,params:e.match.params})}}),c.a.createElement(E.d,{path:"/:event/circle/:circleId?/:productId?",render:function(e){return c.a.createElement(J,{models:t,history:e.history,params:e.match.params})}}))},R={circle:new m,product:new p,favorite:new _};R.circle.request(),a.a.render(c.a.createElement(z,{models:R}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[44,1,2]]]);
//# sourceMappingURL=main.d6cae862.chunk.js.map