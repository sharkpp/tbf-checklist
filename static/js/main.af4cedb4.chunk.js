(window["webpackJsonptbf-checklist"]=window["webpackJsonptbf-checklist"]||[]).push([[0],{44:function(e,t,r){e.exports=r(73)},49:function(e,t,r){},50:function(e,t,r){e.exports=r.p+"static/media/logo.5d5d9eef.svg"},51:function(e,t,r){},73:function(e,t,r){"use strict";r.r(t);var o=r(0),n=r.n(o),c=r(39),a=r.n(c);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(33),r(49);var i=r(21),l=r(22),s=r(27),u="https://cors-anywhere.herokuapp.com/https://techbookfest.org/api",d=/^(.+?)([0-9]+)(.*)$/;function h(e){var t=[].concat(d.exec(e)||["",0,""]).slice(1),r=t[0].codePointAt(0);return 1e3*(12353<=r&&r<=12435?r-12353+10:["\u904b","\u5354"].indexOf(t[0]))+ +t[1]}var f=function(){function e(){Object(i.a)(this,e),this._event=new s,this._store={orderBy:{booth:[]},lookupBy:{booth:{}},circles:{}},this._waitCircleList=null}return Object(l.a)(e,[{key:"request",value:function(e){var t=this;(e=e||{}).circleId=e.circleId||null;var r=[],o=!1;e.circleId?r.push("".concat(u,"/circle/").concat(e.circleId)):(this._waitCircleList=o=!0,r.push("".concat(u,"/circle?eventID=").concat("tbf07","&eventExhibitCourseID=3&visibility=site&limit=100&onlyAdoption=true")));!function e(){var n=r.shift();n?fetch(n,{method:"GET"}).then((function(e){return e.json()})).then((function(o){if(o.cursor&&r.unshift("".concat(n.replace(/&cursor=.+$/,""),"&cursor=").concat(o.cursor)),console.log("CircleModel request",o),o.list)for(var c,a=0;c=o.list[a];++a){t._store.circles[c.id]=c;for(var i,l=0;i=c.spaces[l];++l)t._store.lookupBy.booth[i]=c.id,t._store.orderBy.booth.indexOf(i)<0&&t._store.orderBy.booth.push(i)}else{var s=o;t._store.circles[s.id]=s;for(var u,d=0;u=s.spaces[d];++d)t._store.lookupBy.booth[u]=s.id,t._store.orderBy.booth.indexOf(u)<0&&t._store.orderBy.booth.push(u)}return t._store.orderBy.booth=t._store.orderBy.booth.sort((function(e,t){return h(e)-h(t)})),t._event.emit("change"),e()})).catch((function(e){return console.error(e)})):(o&&(console.log("CircleModel request comp!"),t._waitCircleList=!1),t._event.emit("change"),t._event.emit("loaded"))}()}},{key:"on",value:function(e,t){this._event.on(e,t),0<=["change","loaded"].indexOf(e)&&!1===this._waitCircleList&&t(e)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"getCircleListOrderByBooth",value:function(){var e=this;return(this._store.orderBy.booth||[]).map((function(t){return(e.getCircleByBooth(t)||{}).id}))}},{key:"getCircleByBooth",value:function(e){return this._store.circles[this._store.lookupBy.booth[e]]}},{key:"getCircleBoothOrder",value:function(e){return!1!==this._waitCircleList?-2:this._store.orderBy.booth.indexOf(((this._store.circles[e]||{}).spaces||[])[0])}},{key:"getCircle",value:function(e){return!1===this._waitCircleList&&this._store.circles[e]}},{key:"getFirstBooth",value:function(){return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[0])}},{key:"getLastBooth",value:function(){return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[this._store.orderBy.booth.length-1])}},{key:"getPrevSiblingsBooth",value:function(e){var t=((this._store.circles[e]||{}).spaces||[])[0],r=this._store.orderBy.booth.indexOf(t);return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[r-1])}},{key:"getNextSiblingsBooth",value:function(e){var t=((this._store.circles[e]||{}).spaces||[])[0],r=this._store.orderBy.booth.indexOf(t);return!1===this._waitCircleList&&this.getCircleByBooth(this._store.orderBy.booth[r+1])}}]),e}(),m=r(27),v=function(){function e(){Object(i.a)(this,e),this._event=new m,this._store={orderBy:{seq:{}},products:{}}}return Object(l.a)(e,[{key:"request",value:function(e){var t=this;(e=e||{}).circleId=e.circleId||null;var r=[];if(e.circleId){r.push("".concat("https://cors-anywhere.herokuapp.com/https://techbookfest.org/api","/product?circleExhibitInfoID=").concat(e.circleId,"&limit=100"));!function e(){var o=r.shift();o?fetch(o,{method:"GET"}).then((function(e){return e.json()})).then((function(n){if(n.cursor&&r.unshift("".concat(o.replace(/&cursor=.+$/,""),"&cursor=").concat(n.cursor)),console.log("ProductModel request",n),n.list)for(var c,a=0;c=n.list[a];++a){var i=c.circleExhibitInfoID;t._store.products[i]=t._store.products[i]||{},t._store.products[i][c.id]=c,t._store.orderBy.seq[i]=t._store.orderBy.seq[i]||[],t._store.orderBy.seq[i][c.seq-1]=c.id}return t._event.emit("change"),e()})).catch((function(e){return console.error(e)})):(t._event.emit("change"),t._event.emit("loaded"))}()}}},{key:"on",value:function(e,t){this._event.on(e,t)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"getProductOrder",value:function(e,t){var r=this._store.orderBy.seq[e]||[];return r?r.indexOf(t):-1}},{key:"getProductList",value:function(e){var t=this._store.products[e];return t&&Object.keys(t)}},{key:"getProductByIndex",value:function(e,t){return(this._store.products[e]||{})[(this._store.orderBy.seq[e]||[])[t]]||!1}},{key:"getProduct",value:function(e,t){return(this._store.products[e]||{})[t]||!1}},{key:"getProductCount",value:function(e){var t=this._store.orderBy.seq[e];return t?t.length:-1}},{key:"getPrevSiblings",value:function(e,t){var r=this._store.products[e],o=this._store.orderBy.seq[e],n=o&&o.indexOf(t);return o&&r[o[n-1]]||!1}},{key:"getNextSiblings",value:function(e,t){var r=this._store.products[e],o=this._store.orderBy.seq[e],n=o&&o.indexOf(t);return console.log("getNextSiblings",o,r),o&&r[o[n+1]]||!1}}]),e}(),p=r(27),g="favorite",b=function(){function e(){Object(i.a)(this,e),this._event=new p,this._store=JSON.parse(localStorage.getItem(g)||"{}")}return Object(l.a)(e,[{key:"on",value:function(e,t){this._event.on(e,t)}},{key:"off",value:function(e,t){this._event.removeListener(e,t)}},{key:"isFavorite",value:function(e,t){return!!(t?this._store.tbf07&&this._store.tbf07[e]&&this._store.tbf07[e][t]:this._store.tbf07&&this._store.tbf07[e]&&this._store.tbf07[e].circle)}},{key:"setFavorite",value:function(e,t){if(console.log("setFavorite",e,t),e){this._store.tbf07=this._store.tbf07||{},this._store.tbf07[e]=this._store.tbf07[e]||{circle:null};var r=t||"circle",o=!0!==this._store.tbf07[e][r];this._store.tbf07[e][r]=!0,o&&(localStorage.setItem(g,JSON.stringify(this._store)),this._event.emit("change",{circleId:e,productId:t,favorite:!0}))}}},{key:"unsetFavorite",value:function(e,t){if(console.log("unsetFavorite",e,t),e){this._store.tbf07=this._store.tbf07||{},this._store.tbf07[e]=this._store.tbf07[e]||{circle:null};var r=t||"circle",o=!0===this._store.tbf07[e][r];delete this._store.tbf07[e][r],o&&(localStorage.setItem(g,JSON.stringify(this._store)),this._event.emit("change",{circleId:e,productId:t,favorite:!1}))}}}]),e}(),_=r(24),y=r(16),E=(r(50),r(51),r(75)),B=r(40);var k=function(){return n.a.createElement("div",null,n.a.createElement(B.LinkContainer,{to:"/7/circle/"},n.a.createElement(E.a,null,"\u6280\u8853\u66f8\u5178\uff17")))},I=r(19),w=r(17),x=r(18),O=r(13),C=(r(60),r(10)),L=r.n(C),S=r(25),N=r.n(S),j=r(3),P=r.n(j),q=r(43);var F=function(e){var t=e.models,r=e.circleId,c=e.productId,a=t.favorite,i=Object(o.useState)(a.isFavorite(r,c)),l=Object(I.a)(i,2),s=l[0],u=l[1],d=Object(o.useCallback)((function(){return a.setFavorite(r,c)}),[]),h=Object(o.useCallback)((function(){return a.unsetFavorite(r,c)}),[]);return Object(o.useEffect)((function(){var e=function(e){r==e.circleId&&c==e.productId&&u(e.favorite)};return a.on("change",e),function(){a.off("change",e)}}),[a,r,c]),n.a.createElement("div",{style:{position:"absolute",top:0,right:0,padding:".75rem"},onClick:s?h:d},n.a.createElement(w.a,{icon:s?x.e:q.a,color:"#ffcc00",size:"lg",onClick:s?h:d}))};var G=function(e){var t=e.models,r=e.circleInfo,o=r&&r.circleCutImage||{url:"",width:0,height:1};return n.a.createElement("div",{className:"circle-card"},n.a.createElement(L.a,null,n.a.createElement(L.a.Header,null,n.a.createElement(N.a,{variant:"secondary"},(r.spaces||[])[0]),r.name||" ",n.a.createElement(F,{models:t,circleId:r&&r.id})),n.a.createElement("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"}},o.url&&n.a.createElement(L.a.Img,{variant:"top",src:o.url,style:{width:200*o.width/o.height,height:200}}),!o.url&&n.a.createElement("div",{style:{display:"inline-block",width:141,height:200,border:"5px solid black",overflow:"hidden"}},n.a.createElement("div",{style:{top:"50%",position:"relative",marginTop:"-0.5em"}},"NO IMAGE"))),n.a.createElement(L.a.Body,null,n.a.createElement(L.a.Text,null,n.a.createElement(P.a,null,n.a.createElement(P.a.Group,{controlId:"name"},n.a.createElement(P.a.Label,null,"\u30b5\u30fc\u30af\u30eb\u540d"),n.a.createElement("div",{className:"form-control-plaintext"},r.nameRuby?"".concat(r.name,"(").concat(r.nameRuby,")"):r.name)),n.a.createElement(P.a.Group,{controlId:"spaces"},n.a.createElement(P.a.Label,null,"\u914d\u7f6e"),n.a.createElement("div",{className:"form-control-plaintext"},r.spaces&&r.spaces[0]||"")),n.a.createElement(P.a.Group,{controlId:"penName"},n.a.createElement(P.a.Label,null,"\u30da\u30f3\u30cd\u30fc\u30e0"),n.a.createElement("div",{className:"form-control-plaintext"},r.penName)),n.a.createElement(P.a.Group,{controlId:"webSiteURL"},n.a.createElement(P.a.Label,null,"Web\u30b5\u30a4\u30c8"),n.a.createElement("div",{className:"form-control-plaintext"},r.webSiteURL)),n.a.createElement(P.a.Group,{controlId:"genre"},n.a.createElement(P.a.Label,null,"\u30b8\u30e3\u30f3\u30eb"),n.a.createElement("div",{className:"form-control-plaintext"},r.genre)),n.a.createElement(P.a.Group,{controlId:"genreFreeFormat"},n.a.createElement(P.a.Label,null,"\u30b8\u30e3\u30f3\u30eb\u8a73\u7d30"),n.a.createElement("div",{className:"form-control-plaintext"},r.genreFreeFormat)))))))},A={fanzine:"\u540c\u4eba\u8a8c",commerce:"\u5546\u696d\u8a8c"};var T=function(e){var t=e.models,r=e.circleInfo,o=e.productInfo,c=o&&o.images&&o.images[0]||{url:"",width:0,height:1};return n.a.createElement("div",{className:"product-card"},n.a.createElement(L.a,null,n.a.createElement(L.a.Header,null,n.a.createElement(N.a,{variant:"secondary"},(r.spaces||[])[0]),r.name||" ",n.a.createElement(F,{models:t,circleId:r&&r.id,productId:o&&o.id})),!1,n.a.createElement("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"}},c.url&&n.a.createElement(L.a.Img,{variant:"top",src:c.url,style:{width:200*c.width/c.height,height:200}})),n.a.createElement(L.a.Body,null,n.a.createElement(L.a.Text,null,n.a.createElement(P.a,null,n.a.createElement(P.a.Group,{controlId:"name"},n.a.createElement(P.a.Label,null,"\u9812\u5e03\u7269"),n.a.createElement("div",{className:"form-control-plaintext"},o.name)),n.a.createElement(P.a.Group,{controlId:"page"},n.a.createElement(P.a.Label,null,"\u7a2e\u985e / \u30da\u30fc\u30b8 / \u4fa1\u683c"),n.a.createElement("div",{className:"form-control-plaintext"},"".concat(A[o.type]," / ").concat(o.page," \u30da\u30fc\u30b8 / ").concat(o.price?o.price+" \u5186":""))),n.a.createElement(P.a.Group,{controlId:"firstAppearanceEventName"},n.a.createElement(P.a.Label,null,"\u521d\u51fa"),n.a.createElement("div",{className:"form-control-plaintext"},o.firstAppearanceEventName)),n.a.createElement(P.a.Group,{controlId:"description"},n.a.createElement(P.a.Label,null,"\u6982\u8981"),n.a.createElement("pre",{className:"form-control-plaintext"},o.description)))))))},H={background:"transparent",border:"0px solid transparent"},W=Object.assign({display:"none"},H);var z=function(e){var t=e.models,r=e.history,c=e.params,a=t.circle,i=t.product,l=c.event,s=c.circleId,u=c.productId,d=Object(o.useState)(),h=Object(I.a)(d,2),f=h[0],m=h[1],v=Object(o.useState)(),p=Object(I.a)(v,2),g=p[0],b=p[1],_=Object(o.useState)(),y=Object(I.a)(_,2),E=y[0],B=y[1],k=Object(o.useState)(),C=Object(I.a)(k,2),L=C[0],S=C[1];Object(o.useEffect)((function(){var e=a.getCircle(s);e?b(e):a.request({circleId:s}),i.getProductList(s)?B(E):i.request({circleId:s})}),[a,s]),Object(o.useEffect)((function(){if(s){var e=i.getProduct(s,u);e?S(e):i.request({circleId:s})}}),[s,i,u]),Object(o.useEffect)((function(){var e=function(){if(s)m(a.getCircleListOrderByBooth()),b(a.getCircle(s)),B(i.getProductList(s)),S(i.getProduct(s,u));else{var e=a.getFirstBooth();e&&r.replace("/".concat(l,"/circle/").concat(e.id))}},t=function(){m(a.getCircleListOrderByBooth()),b(a.getCircle(s)),B(i.getProductList(s)),S(i.getProduct(s,u))},o=function(){B(i.getProductList(s)),S(i.getProduct(s,u))},n=function(){B(i.getProductList(s)),S(i.getProduct(s,u))};return a.on("change",e),a.on("loaded",t),i.on("change",o),i.on("loaded",n),function(){a.off("change",e),a.off("loaded",t),i.off("change",o),i.off("loaded",n)}}),[l,a,i,s,u,r]);var N=f||[],j=a.getCircleBoothOrder(s),P=[null].concat(E||[]),q=i.getProductOrder(s,u)+1;return n.a.createElement(O.c,{className:"circle-list",naturalSlideWidth:window.innerWidth,naturalSlideHeight:window.innerHeight,totalSlides:N.length,currentSlide:j},n.a.createElement(O.e,{onMasterSpinner:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.log(">>>",t)}},N.map((function(e,o){var c=g&&g.id==e?g:{id:e};return n.a.createElement(O.d,{key:"_".concat(e,"_").concat(o),index:o},n.a.createElement(O.c,{orientation:"vertical",key:"_".concat(e,"_carousel_").concat(o),className:"product-list",naturalSlideWidth:window.innerWidth,naturalSlideHeight:window.innerHeight,totalSlides:P.length,currentSlide:q},n.a.createElement(O.e,null,P.map((function(r,o){var a=L&&L.id==r?L:{id:r};return n.a.createElement(O.d,{key:"_".concat(e,"_").concat(u,"_").concat(o),index:o},a.name?n.a.createElement(T,{key:"_".concat(e,"_").concat(u,"_item_").concat(o),models:t,circleInfo:c,productInfo:a}):n.a.createElement(G,{key:"_".concat(e,"_").concat(u,"_item_").concat(o),models:t,circleInfo:c}))}))),n.a.createElement(O.a,{style:q-1<0?W:H,onClick:function(){console.log("ButtonTop");var e=i.getPrevSiblings(s,u);r.push(e?"/".concat(l,"/circle/").concat(s,"/").concat(e.id):"/".concat(l,"/circle/").concat(s))}},n.a.createElement(w.a,{icon:x.d,color:"black",size:"3x"})),n.a.createElement(O.b,{style:P.length<=q+1?W:H,onClick:function(){console.log("ButtonButton");var e=i.getNextSiblings(s,u);r.push(e?"/".concat(l,"/circle/").concat(s,"/").concat(e.id):"/".concat(l,"/circle/").concat(s))}},n.a.createElement(w.a,{icon:x.a,color:"black",size:"3x"}))))}))),n.a.createElement(O.a,{style:j-1<0?W:H,onClick:function(){console.log("ButtonBack");var e=a.getPrevSiblingsBooth(s);r.push("/".concat(l,"/circle/").concat(e.id))}},n.a.createElement(w.a,{icon:x.b,color:"black",size:"3x"})),n.a.createElement(O.b,{style:N.length<=j+1?W:H,onClick:function(){console.log("ButtonNext");var e=a.getNextSiblingsBooth(s);r.push("/".concat(l,"/circle/").concat(e.id))}},n.a.createElement(w.a,{icon:x.c,color:"black",size:"3x"})))};var J=function(e){var t=e.models;return n.a.createElement(_.HashRouter,null,!1,n.a.createElement(y.d,{path:"/",exact:!0,render:function(e){return n.a.createElement(k,{models:t,history:e.history,params:e.match.params})}}),n.a.createElement(y.d,{path:"/:event/circle/:circleId?/:productId?",render:function(e){return n.a.createElement(z,{models:t,history:e.history,params:e.match.params})}}))},M={circle:new f,product:new v,favorite:new b};M.circle.request(),a.a.render(n.a.createElement(J,{models:M}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[44,1,2]]]);
//# sourceMappingURL=main.af4cedb4.chunk.js.map